<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <title>KAPMES Puzzle Game</title>
  <style>
    * {
      box-sizing: border-box;
    }
    body {
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #101a3a 0, #02030a 55%, #000 100%);
      color: #f5f5f5;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .game-wrapper {
      width: 100%;
      max-width: 1200px;
      padding: 16px;
      display: grid;
      grid-template-columns: 180px minmax(0, 1fr) 180px;
      gap: 16px;
      align-items: stretch;
    }
    @media (max-width: 900px) {
      .game-wrapper {
        grid-template-columns: minmax(0, 1fr);
        grid-template-rows: auto auto auto;
      }
    }
    .sidebar {
      background: rgba(2, 4, 24, 0.9);
      border-radius: 12px;
      padding: 8px;
      display: flex;
      flex-direction: column;
      gap: 8px;
      border: 1px solid rgba(88, 141, 255, 0.4);
      box-shadow: 0 0 18px rgba(16, 124, 255, 0.35);
      max-height: 80vh;
      overflow: auto;
    }
    .sidebar h2 {
      font-size: 14px;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      opacity: 0.8;
      margin: 0 0 4px;
    }
    .pieces-column {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      justify-content: center;
    }

    main {
      background: rgba(3, 6, 32, 0.96);
      border-radius: 16px;
      padding: 16px 18px 20px;
      border: 1px solid rgba(88, 141, 255, 0.4);
      box-shadow: 0 0 22px rgba(32, 141, 255, 0.4);
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
      max-height: 80vh;
    }
    main h1 {
      margin: 0;
      font-size: 22px;
      letter-spacing: 0.06em;
      text-transform: uppercase;
    }
    main p {
      margin: 0;
      font-size: 14px;
      opacity: 0.85;
      text-align: center;
    }

    #board {
      margin-top: 10px;
      background: radial-gradient(circle at center, #040b1f 0, #01020a 55%);
      border-radius: 14px;
      padding: 8px;
      display: grid;
      gap: 2px;
      border: 1px solid rgba(120, 174, 255, 0.6);
      position: relative;
    }
    .slot {
      border-radius: 4px;
      border: 1px dashed rgba(130, 170, 255, 0.5);
      background: rgba(4, 10, 32, 0.8);
      position: relative;
    }
    .slot.highlight {
      border-style: solid;
      border-color: rgba(142, 209, 255, 0.95);
      box-shadow: 0 0 10px rgba(142, 209, 255, 0.85);
    }
    .piece {
      cursor: grab;
      border-radius: 4px;
      box-shadow: 0 0 10px rgba(120, 174, 255, 0.8);
      border: 1px solid rgba(171, 215, 255, 0.9);
      background-image: url('puzzle.png'); /* <- hier eventueel pad/naam aanpassen */
      background-repeat: no-repeat;
      transition: transform 0.12s ease, box-shadow 0.12s ease;
    }
    .piece.dragging {
      opacity: 0.8;
      transform: scale(1.05);
      box-shadow: 0 0 18px rgba(142, 209, 255, 1);
    }
    .piece::after {
      content: "";
      position: absolute;
      inset: 0;
      border-radius: inherit;
      box-shadow: inset 0 0 8px rgba(0, 0, 0, 0.7);
      pointer-events: none;
    }

    #status {
      font-size: 13px;
      margin-top: 2px;
    }
    #message {
      margin-top: 8px;
      font-size: 15px;
      padding: 6px 12px;
      border-radius: 999px;
      border: 1px solid rgba(151, 233, 186, 0.9);
      background: rgba(6, 82, 45, 0.9);
      display: none;
    }
    #message.visible {
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }
    #message span.icon {
      font-size: 18px;
    }
  </style>
</head>
<body>
  <div class="game-wrapper">
    <aside class="sidebar">
      <h2>Stukken</h2>
      <div id="pieces-left" class="pieces-column"></div>
    </aside>

    <main>
      <h1>KAPMES PUZZLE</h1>
      <p>Sleep de stukken vanuit links en rechts naar het midden en maak de volledige KAPMES-illustratie.</p>
      <p id="status">Puzzle wordt opgebouwd…</p>
      <div id="board"></div>
      <div id="message">
        <span class="icon">✨</span>
        <span>Puzzle compleet. Welkom in het KAPMES-universum.</span>
      </div>
    </main>

    <aside class="sidebar">
      <h2>Stukken</h2>
      <div id="pieces-right" class="pieces-column"></div>
    </aside>
  </div>

  <script>
    const ROWS = 5;           // 5 rijen x 6 kolommen = 30 stukken
    const COLS = 6;
    const IMAGE_SRC = "puzzle.png"; // pas aan als de bestandsnaam anders is

    const board = document.getElementById("board");
    const piecesLeft = document.getElementById("pieces-left");
    const piecesRight = document.getElementById("pieces-right");
    const statusEl = document.getElementById("status");
    const messageEl = document.getElementById("message");

    let draggedId = null;

    function handleDragStart(e) {
      draggedId = this.id;
      this.classList.add("dragging");
      if (e.dataTransfer) {
        e.dataTransfer.setData("text/plain", this.id);
      }
    }

    function handleDragEnd() {
      this.classList.remove("dragging");
    }

    function handleDragOver(e) {
      e.preventDefault();
      if (this.classList.contains("slot")) {
        this.classList.add("highlight");
      }
    }

    function handleDragLeave(e) {
      if (this.classList.contains("slot")) {
        this.classList.remove("highlight");
      }
    }

    function handleDrop(e) {
      e.preventDefault();
      if (this.classList.contains("slot")) {
        this.classList.remove("highlight");
      }

      const pieceId = (e.dataTransfer && e.dataTransfer.getData("text/plain")) || draggedId;
      const piece = document.getElementById(pieceId);
      if (!piece) return;

      // Als er al een stuk in de slot ligt: swap
      if (this.classList.contains("slot")) {
        if (this.firstElementChild && this.firstElementChild !== piece) {
          const otherPiece = this.firstElementChild;
          const origin = piece.parentElement;
          origin.appendChild(otherPiece);
        }
      }

      this.appendChild(piece);
      checkCompletion();
    }

    function checkCompletion() {
      const slots = document.querySelectorAll(".slot");
      let correct = 0;
      slots.forEach((slot) => {
        const piece = slot.firstElementChild;
        if (piece && piece.dataset.index === slot.dataset.index) {
          correct++;
        }
      });
      statusEl.textContent =
        "Correct geplaatste stukken: " + correct + " / " + slots.length;

      if (correct === slots.length && slots.length > 0) {
        messageEl.classList.add("visible");
      } else {
        messageEl.classList.remove("visible");
      }
    }

    function setupPuzzle() {
      const img = new Image();
      img.src = IMAGE_SRC;
      img.onload = () => {
        const maxBoardWidth = 800;
        let boardWidth = Math.min(maxBoardWidth, img.naturalWidth);
        const scale = boardWidth / img.naturalWidth;
        let boardHeight = img.naturalHeight * scale;

        const tileW = boardWidth / COLS;
        const tileH = boardHeight / ROWS;

        board.style.width = boardWidth + "px";
        board.style.height = boardHeight + "px";
        board.style.gridTemplateColumns = `repeat(${COLS}, ${tileW}px)`;
        board.style.gridTemplateRows = `repeat(${ROWS}, ${tileH}px)`;

        const indices = Array.from({ length: ROWS * COLS }, (_, i) => i);

        // Slots aanmaken
        indices.forEach((index) => {
          const slot = document.createElement("div");
          slot.className = "slot";
          slot.dataset.index = String(index);
          slot.style.width = tileW + "px";
          slot.style.height = tileH + "px";
          slot.addEventListener("dragover", handleDragOver);
          slot.addEventListener("dragleave", handleDragLeave);
          slot.addEventListener("drop", handleDrop);
          board.appendChild(slot);
        });

        // Stukken schudden
        const shuffled = indices
          .slice()
          .sort(() => Math.random() - 0.5);

        shuffled.forEach((index, position) => {
          const piece = document.createElement("div");
          piece.className = "piece";
          piece.id = "piece-" + index;
          piece.dataset.index = String(index);
          piece.setAttribute("draggable", "true");

          piece.style.width = tileW + "px";
          piece.style.height = tileH + "px";
          piece.style.backgroundSize = boardWidth + "px " + boardHeight + "px";

          const col = index % COLS;
          const row = Math.floor(index / COLS);
          const bgX = -col * tileW;
          const bgY = -row * tileH;
          piece.style.backgroundPosition = bgX + "px " + bgY + "px";

          piece.addEventListener("dragstart", handleDragStart);
          piece.addEventListener("dragend", handleDragEnd);

          const target =
            position < shuffled.length / 2 ? piecesLeft : piecesRight;
          target.appendChild(piece);
        });

        [piecesLeft, piecesRight].forEach((container) => {
          container.addEventListener("dragover", handleDragOver);
          container.addEventListener("drop", handleDrop);
        });

        statusEl.textContent =
          "Sleep de stukken naar het midden en maak de puzzel compleet.";
      };

      img.onerror = () => {
        statusEl.textContent =
          "Afbeelding kon niet geladen worden. Controleer het pad naar het bestand.";
      };
    }

    setupPuzzle();
  </script>
</body>
</html>
